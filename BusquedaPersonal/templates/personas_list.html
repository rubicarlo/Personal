{% load static %}

<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Lista de Personas{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/5.3.0/css/bootstrap.min.css">
    <script src="{% static 'js/scripts.js' %}"></script>
    <link rel="icon" href="{% static 'plantita.ico' %}" type="image/x-icon">

</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar (20% de ancho) -->
            <div class="col-md-3 col-lg-2 bg-light sidebar">
                <h3>Buscar Personas</h3>
                <!-- Campo de búsqueda -->
                <input type="text" id="busqueda" class="form-control" placeholder="Buscar..." />

                <!-- Lista estilizada -->
                <ul id="resultados" class="list-unstyled mt-3">
                    {% for persona in personas %}
                        <li class="{% if forloop.counter0|divisibleby:2 %}bg-white{% else %}bg-light{% endif %} my-1 rounded">
                            <a href="?dni={{ persona.dni }}" class="text-decoration-none text-dark p-2 d-block hover-bg-primary">
                                {{ persona.apellidos }} {{ persona.nombre }}
                            </a>
                        </li>
                    {% empty %}
                        <li>No hay personas registradas.</li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Contenido principal (80% de ancho) -->
            <div class="col-md-9 col-lg-10">
                {% block content %}
                <!-- Aquí se renderizarán las plantillas que extiendan de esta -->
                {% endblock %}
            </div>
        </div>
    </div>

    <script>
        // Obtener el campo de búsqueda
        const inputBusqueda = document.getElementById('busqueda');
        
        // Evento que se activa cada vez que se escribe en el campo de búsqueda
        inputBusqueda.addEventListener('input', () => {
            const busqueda = inputBusqueda.value;

            // Realizar la solicitud a la vista de filtrado
            fetch(`/api/personas/filtrar/?search=${busqueda}`)
                .then(response => response.json())
                .then(personasFiltradas => {
                    const resultados = document.getElementById('resultados');
                    resultados.innerHTML = '';  // Limpiar resultados previos

                    // Verificar si hay resultados filtrados
                    if (personasFiltradas.length === 0) {
                        resultados.innerHTML = '<li>No se encontraron resultados.</li>';
                    } else {
                        // Agregar cada persona filtrada a la lista
                        personasFiltradas.forEach(persona => {
                            const li = document.createElement('li');
                            li.className = 'my-1 rounded';
                            li.innerHTML = `
                                <a href="?dni=${persona.dni}" class="text-decoration-none text-dark p-2 d-block hover-bg-primary">
                                    ${persona.apellidos}, ${persona.nombre}
                                </a>`;
                            resultados.appendChild(li);
                        });
                    }
                })
                .catch(error => {
                    console.error('Error al filtrar:', error);
                });
        });
    </script>
</body>
</html>